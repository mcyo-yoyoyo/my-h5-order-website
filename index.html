<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ziannaç‚¹é¤åŠ©æ‰‹</title>
    <style>
        /* ä¿æŒåŸæœ‰çš„ CSS æ ·å¼ï¼Œæ— éœ€ä¿®æ”¹ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .role-selection {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .role-btn {
            padding: 20px 25px;
            border: none;
            border-radius: 12px;
            background: #4ecdc4;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            flex: 1;
            max-width: 140px;
            min-width: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .role-btn:hover {
            background: #45b7aa;
            transform: translateY(-5px);
        }

        .role-btn.active {
            background: #ff6b6b;
        }

        .role-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
            background: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 12px 15px;
            border: none;
            border-radius: 25px;
            background: #4ecdc4;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            flex: 1;
            max-width: 90px;
            min-width: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .tab-button:hover {
            background: #45b7aa;
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: #ff6b6b;
        }

        .tab-icon {
            font-size: 20px;
            margin-bottom: 3px;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .tab-content.active {
            display: block;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .menu-item {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            text-align: center;
        }

        .menu-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        .menu-item.selected {
            border-color: #ff6b6b;
            background: #fff5f5;
        }

        .menu-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-bottom: 1px solid #eee;
        }

        .menu-name {
            padding: 10px;
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4ecdc4;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .btn-primary {
            background: #4ecdc4;
            color: white;
        }

        .btn-primary:hover {
            background: #45b7aa;
        }

        .btn-danger {
            background: #ff6b6b;
            color: white;
        }

        .btn-danger:hover {
            background: #ff5252;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .order-summary {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }

        .order-summary h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .selected-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .selected-item {
            background: #4ecdc4;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            position: relative;
        }

        .delete-dish {
            margin-left: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .rating {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 10px;
        }

        .star {
            font-size: 28px;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
        }

        .star.active,
        .star:hover {
            color: #ffd700;
        }

        .history-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .history-date {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .history-dishes {
            margin-bottom: 8px;
            font-size: 14px;
        }

        .history-dishes-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
        }

        .history-dish-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 70px;
            position: relative;
        }

        .history-dish-image {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 8px;
        }

        .history-dish-name {
            font-size: 12px;
            margin-top: 4px;
            text-align: center;
        }

        .history-rating {
            color: #ffd700;
            font-size: 14px;
        }

        .notification {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.success {
            background: #4CAF50;
        }

        .notification.error {
            background: #f44336;
        }

        .notification.info {
            background: #2196F3;
        }

        .upload-section {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            background: #fafafa;
        }

        .upload-btn {
            display: inline-block;
            padding: 12px 25px;
            background: #4ecdc4;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 16px;
        }

        .upload-btn:hover {
            background: #45b7aa;
        }

        .hidden {
            display: none;
        }

        .wishlist-item {
            background: #e8f5e9;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .wishlist-text {
            flex: 1;
            font-size: 14px;
        }

        .wishlist-image {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 8px;
            margin-left: 15px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .back-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 10px 15px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .meal-type-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .meal-type-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: #4ecdc4;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .meal-type-btn:hover {
            background: #45b7aa;
        }

        .meal-type-btn.active {
            background: #ff6b6b;
        }

        .rating-comment {
            margin-top: 10px;
        }

        .rating-comment textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
            min-height: 60px;
        }

        @media (max-width: 480px) {
            .role-btn {
                padding: 15px 20px;
                max-width: 100px;
                min-width: 80px;
            }

            .role-icon {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }

            .menu-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 15px;
            }

            .tab-button {
                padding: 10px 12px;
                font-size: 12px;
                min-width: 60px;
            }

            .header h1 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ½ï¸ å°ç™¾åˆæ¯æ—¥â€œé£Ÿâ€å…‰</h1>
            <p>Ziannaç‚¹é¤åŠ©æ‰‹ï¼Œå¤–å©†ä¸ç”¨æ„ï¼Œå®è´åƒçš„é¦™ï¼</p>
        </div>

        <div id="rolePage" class="page active">
            <div class="role-selection">
                <button class="role-btn" onclick="switchRole('child')">
                    <div class="role-icon">ğŸ‘§</div>
                    <span>å­©å­</span>
                </button>
                <button class="role-btn" onclick="switchRole('parent')">
                    <div class="role-icon">ğŸ‘¨ğŸ‘©</div>
                    <span>çˆ¶æ¯</span>
                </button>
                <button class="role-btn" onclick="switchRole('grandma')">
                    <div class="role-icon">ğŸ‘µ</div>
                    <span>å¤–å©†</span>
                </button>
            </div>
        </div>

        <div id="contentPage" class="page">
            <button class="back-btn" onclick="goToRolePage()">è¿”å›</button>

            <div class="tabs" id="tabsContainer">
                </div>

            <div id="order" class="tab-content">
                <h2>ğŸ“‹ æƒ³åƒå•¥ç‚¹å•¥ </h2>
                <div class="meal-type-buttons">
                    <button class="meal-type-btn active" onclick="switchMealType('breakfast')">ğŸ³ æ—©é¤</button>
                    <button class="meal-type-btn" onclick="switchMealType('lunch')">ğŸ± ä¸­é¤</button>
                    <button class="meal-type-btn" onclick="switchMealType('dinner')">ğŸ² æ™šé¤</button>
                </div>
                <div class="menu-grid" id="menuGrid">
                    </div>
                <div class="order-summary">
                    <h3>ğŸ›’ å·²é€‰æ‹©èœå“</h3>
                    <div class="selected-items" id="selectedItems">
                        </div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="submitOrder()">æäº¤ç‚¹é¤</button>
                    <button class="btn btn-danger" onclick="clearSelection()">æ¸…ç©ºé€‰æ‹©</button>
                </div>
            </div>

            <div id="add" class="tab-content">
                <h2>â• æ·»åŠ æ–°èœå“</h2>
                <div class="form-group">
                    <label>èœå“ç±»å‹ï¼š</label>
                    <select id="newDishType">
                        <option value="breakfast">æ—©é¤</option>
                        <option value="lunch">ä¸­é¤</option>
                        <option value="dinner">æ™šé¤</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newDishName">èœå“åç§°</label>
                    <input type="text" id="newDishName" required placeholder="è¯·è¾“å…¥èœå“åç§°">
                </div>
                <div class="upload-section">
                    <p>ä¸Šä¼ èœå“å›¾ç‰‡ï¼ˆæ‹ç…§æˆ–é€‰æ‹©ï¼‰</p>
                    <input type="file" id="imageUpload" accept="image/*" capture="environment" class="hidden">
                    <div class="btn btn-primary upload-btn" onclick="document.getElementById('imageUpload').click()">é€‰æ‹©å›¾ç‰‡</div>
                    <div id="imagePreview" style="margin-top: 10px;"></div>
                </div>
                <div class="form-group">
                    <label for="newDishDescription">èœå“æè¿°</label>
                    <textarea id="newDishDescription" placeholder="è¯·è¾“å…¥èœå“æè¿°ï¼ˆå¯é€‰ï¼‰"></textarea>
                </div>
                <button class="btn btn-primary" onclick="addDish()">æ·»åŠ èœå“</button>
            </div>

            <div id="manage" class="tab-content">
                <h2>ğŸ”§ ç®¡ç†ç°æœ‰èœå“</h2>
                <div style="margin-bottom: 15px;">
                    <label>ç­›é€‰èœå“ç±»å‹ï¼š</label>
                    <select id="manageType" onchange="filterManageDishes()">
                        <option value="all">å…¨éƒ¨</option>
                        <option value="breakfast">æ—©é¤</option>
                        <option value="lunch">ä¸­é¤</option>
                        <option value="dinner">æ™šé¤</option>
                    </select>
                </div>
                <div class="menu-grid" id="manageGrid">
                    </div>
            </div>

            <div id="wishlist" class="tab-content">
                <h2>ğŸ’ æˆ‘å¥½æƒ³åƒ </h2>
                <div class="form-group">
                    <label for="wishlistText">è¾“å…¥æƒ³åƒçš„èœï¼ˆæ–‡å­—ï¼‰</label>
                    <input type="text" id="wishlistText" placeholder="ä¾‹å¦‚ï¼šç³–é†‹æ’éª¨ã€çº¢çƒ§è‚‰">
                </div>
                <div class="upload-section">
                    <p>æˆ–æ‹ç…§ä¸Šä¼ æƒ³åƒçš„èœ</p>
                    <input type="file" id="wishlistImageUpload" accept="image/*" capture="environment" class="hidden">
                    <div class="btn btn-primary upload-btn" onclick="document.getElementById('wishlistImageUpload').click()">æ‹ç…§/é€‰æ‹©å›¾ç‰‡</div>
                    <div id="wishlistImagePreview" style="margin-top: 10px;"></div>
                </div>
                <button class="btn btn-success" onclick="addToWishlist()">å‘ç»™çˆ¸çˆ¸å¦ˆå¦ˆ</button>

                <h3 style="margin-top: 20px;">å¿ƒæ„¿å•åˆ—è¡¨</h3>
                <div id="wishlistList">
                    </div>
            </div>

            <div id="history" class="tab-content">
                <h2>ğŸ“… ç‚¹é¤å†å²è®°å½•</h2>
                <div id="historyList">
                    </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@4.10.0/dist/av-min.js"></script>

    <script>
        // =======================================================
        // ========== ğŸš© å…³é”®ï¼šLeanCloud åˆå§‹åŒ–é…ç½® ğŸš© ==========
        // =======================================================
        AV.init({
            appId: "4bOWfCdwX0wU6w7MEhEDrYui-gzGzoHsz",  // <<-- æ›¿æ¢ä¸ºæ‚¨çš„ App ID
            appKey: "VZx0lrWmYJY2QiiKXfdFqXmI", // <<-- æ›¿æ¢ä¸ºæ‚¨çš„ App Key
            serverURL: "https://4bowfcdw.lc-cn-n1-shared.com"     // <<-- æ›¿æ¢ä¸ºæ‚¨çš„ Server URL
        });

        // å®šä¹‰ LeanCloud çš„æ•°æ®è¡¨ï¼ˆClassï¼‰
        const Dish = AV.Object.extend('Dish');
        const Order = AV.Object.extend('Order');
        const Wishlist = AV.Object.extend('Wishlist');

        // =======================================================
        // ========== å…¨å±€çŠ¶æ€å˜é‡ (ä¸å†ä½¿ç”¨ localStorage) ==========
        // =======================================================
        let currentRole = null; // å½“å‰è§’è‰²
        let currentMealType = 'breakfast'; // å½“å‰é¤æ¬¡ç±»å‹
        let selectedDishes = []; // é€‰ä¸­çš„èœå“ ID åˆ—è¡¨ (ä½¿ç”¨ LeanCloud objectId)
        let currentImage = null; // å½“å‰èœå“å›¾ç‰‡ URL (ç”¨äºæ·»åŠ èœå“)
        let currentWishlistImage = null; // å½“å‰å¿ƒæ„¿å•å›¾ç‰‡ URL

        // =======================================================
        // ========== æ ¸å¿ƒå·¥å…·å‡½æ•° (Notification & Upload) ==========
        // =======================================================

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification show ${type}`;
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        /**
         * LeanCloud æ–‡ä»¶ä¸Šä¼ å‡½æ•°ï¼šå°†å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ åˆ°äº‘ç«¯å¹¶è¿”å› URL
         */
        async function uploadImageToLeanCloud(file) {
            if (!file) return null;
            const leanFile = new AV.File(file.name, file);

            showNotification('å›¾ç‰‡ä¸Šä¼ ä¸­ï¼Œè¯·ç¨å€™...', 'info');
            try {
                const result = await leanFile.save();
                showNotification('å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼', 'success');
                return result.url();
            } catch (error) {
                console.error("æ–‡ä»¶ä¸Šä¼ å¤±è´¥:", error);
                showNotification('å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œå’Œæƒé™ï¼', 'error');
                return null;
            }
        }

        // =======================================================
        // ========== LeanCloud æ•°æ®è¯»å–å‡½æ•° (æ›¿ä»£ localStorage.getItem) ==========
        // =======================================================

        /**
         * è·å–æ‰€æœ‰èœå“æ•°æ® (Dish Class)
         */
        async function fetchDishes() {
            const query = new AV.Query('Dish');
            query.descending('createdAt');
            try {
                const leanDishes = await query.find();
                return leanDishes.map(d => ({
                    objectId: d.id, // LeanCloud å¯¹è±¡çš„å”¯ä¸€ID
                    name: d.get('name'),
                    image: d.get('image') || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjREREIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzMzMyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+JiM4MjIwO1Vua25vd24gSW1hZ2UmIzgyMjE7PC90ZXh0Pjwvc3ZnPg==',
                    description: d.get('description'),
                    type: d.get('type')
                }));
            } catch (error) {
                console.error("è·å–èœå“å¤±è´¥:", error);
                showNotification('è·å–èœå“å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œå’Œé…ç½®ï¼', 'error');
                return [];
            }
        }

        /**
         * è·å–ç‚¹é¤å†å² (Order Class)
         */
        async function fetchOrderHistory() {
            const query = new AV.Query('Order');
            query.descending('createdAt');
            query.limit(100);
            try {
                const orders = await query.find();
                return orders.map(o => ({
                    objectId: o.id,
                    // ä½¿ç”¨ createdAt æ—¶é—´æˆ³ä½œä¸ºæ—¥æœŸï¼Œæ›´ç²¾ç¡®
                    date: new Date(o.get('createdAt')).toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' }),
                    mealType: o.get('mealType'),
                    dishes: o.get('dishes') || [], 
                    rating: o.get('rating') || 0,
                    comment: o.get('comment') || '',
                    role: o.get('role') || 'æœªçŸ¥è§’è‰²' // ç¡®ä¿è®°å½•äº†è§’è‰²
                }));
            } catch (error) {
                console.error("è·å–è®¢å•å¤±è´¥:", error);
                showNotification('è·å–ç‚¹é¤è®°å½•å¤±è´¥ï¼', 'error');
                return [];
            }
        }

        /**
         * è·å–å¿ƒæ„¿å•åˆ—è¡¨ (Wishlist Class)
         */
        async function fetchWishlist() {
            const query = new AV.Query('Wishlist');
            query.descending('createdAt');
            try {
                const wishes = await query.find();
                return wishes.map(w => ({
                    objectId: w.id,
                    text: w.get('text'),
                    image: w.get('image')
                }));
            } catch (error) {
                console.error("è·å–å¿ƒæ„¿å•å¤±è´¥:", error);
                showNotification('è·å–å¿ƒæ„¿å•å¤±è´¥ï¼', 'error');
                return [];
            }
        }


        // =======================================================
        // ========== é¡µé¢åˆ‡æ¢åŠæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ (å·²æ›´æ–°ä¸º async) ==========
        // =======================================================

        function switchRole(role) {
            currentRole = role;

            document.getElementById('rolePage').classList.remove('active');
            document.getElementById('contentPage').classList.add('active');

            generateTabs();
        }

        function goToRolePage() {
            document.getElementById('contentPage').classList.remove('active');
            document.getElementById('rolePage').classList.add('active');
            currentRole = null;
            selectedDishes = []; // è¿”å›æ—¶æ¸…ç©ºé€‰æ‹©
        }

        function generateTabs() {
            // ... (æ­¤å‡½æ•°é€»è¾‘ä¿æŒä¸å˜)
            const tabsContainer = document.getElementById('tabsContainer');
            tabsContainer.innerHTML = '';
            // ... (åŒä¸Šï¼Œä¸å†é‡å¤ç²˜è´´)

            let tabs = [];
            if (currentRole === 'child') {
                tabs = [
                    { id: 'order', name: 'æˆ‘è¦ç‚¹é¤', icon: 'ğŸ“‹' },
                    { id: 'history', name: 'ç‚¹é¤è®°å½•', icon: 'ğŸ“…' },
                    { id: 'wishlist', name: 'å¿ƒæ„¿å•', icon: 'ğŸ’' }
                ];
            } else if (currentRole === 'grandma') {
                tabs = [
                    { id: 'history', name: 'ç‚¹é¤è®°å½•', icon: 'ğŸ“…' },
                    { id: 'wishlist', name: 'å¿ƒæ„¿å•', icon: 'ğŸ’' }
                ];
            } else if (currentRole === 'parent') {
                tabs = [
                    { id: 'wishlist', name: 'å¿ƒæ„¿å•', icon: 'ğŸ’' },
                    { id: 'history', name: 'ç‚¹é¤è®°å½•', icon: 'ğŸ“…' },
                    { id: 'manage', name: 'ç®¡ç†èœå“', icon: 'ğŸ”§' },
                    { id: 'add', name: 'æ·»åŠ èœå“', icon: 'â•' }
                ];
            }

            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            tabs.forEach(tab => {
                const button = document.createElement('button');
                button.className = 'tab-button';
                button.onclick = (e) => switchTab(tab.id, e); // ä¼ é€’ event å¯¹è±¡
                button.innerHTML = `<div class="tab-icon">${tab.icon}</div><div>${tab.name}</div>`;
                tabsContainer.appendChild(button);
            });

            if (tabs.length > 0) {
                const firstButton = tabsContainer.querySelector('.tab-button');
                if (firstButton) {
                    firstButton.classList.add('active');
                    document.getElementById(tabs[0].id).classList.add('active');
                    // é¦–æ¬¡åŠ è½½å†…å®¹
                    loadTabContent(tabs[0].id);
                }
            }
        }

        function switchTab(tabName, event) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // ç¡®ä¿ç‚¹å‡»çš„æ˜¯æŒ‰é’®æœ¬èº«
            let targetButton = event.target.closest('.tab-button');
            if (targetButton) {
                targetButton.classList.add('active');
            } else {
                // å¦‚æœæ˜¯ç›´æ¥è°ƒç”¨çš„ switchTab, å°è¯•æ‰¾åˆ°å¯¹åº”çš„æŒ‰é’®æ¿€æ´»
                document.querySelectorAll('.tab-button').forEach(btn => {
                    if(btn.textContent.includes(document.getElementById(tabName).querySelector('h2').textContent.split(' ')[1])) {
                         btn.classList.add('active');
                    }
                });
            }

            document.getElementById(tabName).classList.add('active');
            loadTabContent(tabName);
        }

        async function loadTabContent(tabName) {
            // æ ¹æ®æ ‡ç­¾é‡æ–°åŠ è½½å†…å®¹
            if(tabName === 'order') {
                await renderMenu(currentMealType);
            } else if(tabName === 'manage') {
                await filterManageDishes();
            } else if(tabName === 'history') {
                await renderHistory();
            } else if(tabName === 'wishlist') {
                await renderWishlist();
            }
        }

        function switchMealType(mealType) {
            currentMealType = mealType;

            document.querySelectorAll('.meal-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            renderMenu(mealType); // é‡æ–°æ¸²æŸ“èœå•
        }

        // =======================================================
        // ========== ç‚¹é¤é¡µ (Order, Child Role) ==========
        // =======================================================

        /**
         * æ¸²æŸ“èœå• (ä» LeanCloud è·å–æ•°æ®)
         */
        async function renderMenu(dishType = 'breakfast') {
            const menuGrid = document.getElementById('menuGrid');
            menuGrid.innerHTML = 'æ­£åœ¨åŠ è½½èœå•...';
            
            const allDishes = await fetchDishes(); // <--- ä» LeanCloud è·å–
            menuGrid.innerHTML = '';
            
            const filteredDishes = allDishes.filter(d => d.type === dishType);
            
            if (filteredDishes.length === 0) {
                menuGrid.innerHTML = '<p style="text-align: center;">æš‚æ— èœå“ï¼Œè¯·è”ç³»çˆ¶æ¯æ·»åŠ ã€‚</p>';
                updateSelectedItems(allDishes);
                return;
            }

            filteredDishes.forEach(dish => {
                const menuItem = document.createElement('div');
                menuItem.className = 'menu-item';
                
                if (currentRole === 'child') {
                    // ä½¿ç”¨ objectId è¿›è¡Œé€‰æ‹©æ ‡è®°
                    menuItem.onclick = () => toggleDishSelection(dish.objectId); 
                    if(selectedDishes.includes(dish.objectId)) {
                        menuItem.classList.add('selected');
                    }
                }
                
                menuItem.innerHTML = `
                    <img src="${dish.image}" alt="${dish.name}" class="menu-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjREREIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzMzMyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+JiM4MjIwO1Vua25vd24gSW1hZ2UmIzgyMjE7PC90ZXh0Pjwvc3ZnPg=='">
                    <div class="menu-name">${dish.name}</div>
                `;
                
                menuGrid.appendChild(menuItem);
            });
            
            updateSelectedItems(allDishes); // ä¼ å…¥æ‰€æœ‰èœå“æ•°æ®
        }

        function toggleDishSelection(dishObjectId) {
            if (currentRole !== 'child') return;
            
            const index = selectedDishes.indexOf(dishObjectId);
            if(index > -1) {
                selectedDishes.splice(index, 1);
            } else {
                selectedDishes.push(dishObjectId);
            }
            // é‡æ–°æ¸²æŸ“å½“å‰ç­›é€‰çš„èœå•
            renderMenu(currentMealType); 
        }

        async function updateSelectedItems(allDishes) {
            const selectedItemsDiv = document.getElementById('selectedItems');
            selectedItemsDiv.innerHTML = '';
            
            if (!allDishes) {
                 allDishes = await fetchDishes(); // å¦‚æœæœªä¼ å…¥ï¼Œåˆ™è¿œç¨‹è·å–
            }

            if (currentRole !== 'child') return;
            
            selectedDishes.forEach(objectId => {
                const dish = allDishes.find(d => d.objectId === objectId);
                if(dish) {
                    const itemSpan = document.createElement('span');
                    itemSpan.className = 'selected-item';
                    itemSpan.innerHTML = `${dish.name} <span class="delete-dish" onclick="removeDishFromSelection('${objectId}')">Ã—</span>`;
                    selectedItemsDiv.appendChild(itemSpan);
                }
            });
        }

        function removeDishFromSelection(dishObjectId) {
            if (currentRole !== 'child') return;
            
            const index = selectedDishes.indexOf(dishObjectId);
            if(index > -1) {
                selectedDishes.splice(index, 1);
                renderMenu(currentMealType); 
            }
        }

        /**
         * æäº¤ç‚¹é¤ (ä¿å­˜åˆ° Order Class)
         */
        async function submitOrder() {
            if (currentRole !== 'child') return;
            
            if(selectedDishes.length === 0) {
                showNotification('è¯·è‡³å°‘é€‰æ‹©ä¸€é“èœï¼', 'error');
                return;
            }
            
            const allDishes = await fetchDishes();
            
            // å‡†å¤‡è¦å­˜å‚¨çš„èœå“è¯¦æƒ…ï¼ŒåŒ…å«å›¾ç‰‡ URL å’Œåç§°
            const dishesToSave = selectedDishes.map(objectId => {
                const dish = allDishes.find(d => d.objectId === objectId);
                return dish ? { 
                    name: dish.name, 
                    type: dish.type, 
                    image: dish.image,
                    dishId: dish.objectId 
                } : null;
            }).filter(d => d !== null);

            if (dishesToSave.length === 0) {
                 showNotification('èœå“æ•°æ®è·å–å¼‚å¸¸ï¼Œè¯·é‡è¯•ï¼', 'error');
                 return;
            }

            const orderObj = new Order();
            orderObj.set('mealType', currentMealType);
            orderObj.set('dishes', dishesToSave); // å­˜å‚¨åŒ…å«å›¾ç‰‡çš„å®Œæ•´èœå“æ•°ç»„
            orderObj.set('rating', 0);
            orderObj.set('comment', '');
            orderObj.set('role', currentRole); // å­˜å‚¨æ“ä½œè§’è‰²

            try {
                await orderObj.save(); // è·¨ç«¯åŒæ­¥ä¿å­˜
                showNotification(`ç‚¹é¤æˆåŠŸï¼${getMealTypeName(currentMealType)}å·²æäº¤`, 'success');
                
                selectedDishes = [];
                renderMenu(currentMealType); // åˆ·æ–°ç‚¹é¤é¡µé¢
            } catch (error) {
                console.error("æäº¤è®¢å•å¤±è´¥:", error);
                showNotification('æäº¤è®¢å•å¤±è´¥ï¼', 'error');
            }
        }

        function clearSelection() {
            if (currentRole !== 'child') return;
            selectedDishes = [];
            renderMenu(currentMealType);
            showNotification('å·²æ¸…ç©ºé€‰æ‹©', 'success');
        }

        function getMealTypeName(type) {
            switch(type) {
                case 'breakfast': return 'æ—©é¤';
                case 'lunch': return 'ä¸­é¤';
                case 'dinner': return 'æ™šé¤';
                default: return 'é¤';
            }
        }

        // =======================================================
        // ========== èœå“ç®¡ç† (Add, Manage, Parent Role) ==========
        // =======================================================

        /**
         * æ·»åŠ èœå“ (ä¿å­˜åˆ° Dish Class)
         */
        async function addDish() {
            if (currentRole !== 'parent') return;
            
            const name = document.getElementById('newDishName').value.trim();
            const type = document.getElementById('newDishType').value;
            const description = document.getElementById('newDishDescription').value;
            
            if (!name) {
                showNotification('è¯·è¾“å…¥èœå“åç§°ï¼', 'error');
                return;
            }
            if (!currentImage) {
                showNotification('è¯·ä¸Šä¼ èœå“å›¾ç‰‡ï¼', 'error');
                return;
            }
            
            const newDish = new Dish();
            newDish.set('name', name);
            newDish.set('type', type);
            newDish.set('description', description);
            newDish.set('image', currentImage); // å­˜å‚¨å›¾ç‰‡ URL

            try {
                await newDish.save(); // è·¨ç«¯åŒæ­¥ä¿å­˜
                showNotification('èœå“æ·»åŠ æˆåŠŸï¼', 'success');
                
                // æ¸…ç©ºè¡¨å•
                document.getElementById('newDishName').value = '';
                document.getElementById('newDishDescription').value = '';
                document.getElementById('imagePreview').innerHTML = '';
                currentImage = null;
                
                // åˆ‡æ¢åˆ°ç®¡ç†é¡µé¢æˆ–ç‚¹é¤é¡µé¢
                switchTab('manage', { target: document.querySelector('.tab-button[onclick*="manage"]') });
            } catch (error) {
                 console.error("æ·»åŠ èœå“å¤±è´¥:", error);
                 showNotification('æ·»åŠ èœå“å¤±è´¥ï¼', 'error');
            }
        }

        /**
         * æ¸²æŸ“ç®¡ç†èœå“åˆ—è¡¨ (ä» LeanCloud è·å– Dish Class)
         */
        async function filterManageDishes() {
            if (currentRole !== 'parent') return;
            
            const manageGrid = document.getElementById('manageGrid');
            manageGrid.innerHTML = 'æ­£åœ¨åŠ è½½èœå“åˆ—è¡¨...';
            
            const selectedType = document.getElementById('manageType').value;
            const allDishes = await fetchDishes(); // ä» LeanCloud è·å–
            
            const filtered = allDishes.filter(d => selectedType === 'all' || d.type === selectedType);
            
            manageGrid.innerHTML = '';

            if (filtered.length === 0) {
                 manageGrid.innerHTML = '<p style="text-align: center;">è¯¥é¤æ¬¡æš‚æ— èœå“ã€‚</p>';
                 return;
            }

            filtered.forEach(dish => {
                const dishItem = document.createElement('div');
                dishItem.className = 'menu-item';
                dishItem.style.position = 'relative';
                dishItem.innerHTML = `
                    <img src="${dish.image}" alt="${dish.name}" class="menu-image" onerror="this.src='data:image/svg+xml;base64,...'">
                    <div class="menu-name">${dish.name} (${getMealTypeName(dish.type)})</div>
                    <button class="btn btn-danger" style="width: 100%; border-radius: 0; margin-top: -5px;" onclick="deleteDish('${dish.objectId}')">åˆ é™¤</button>
                `;
                manageGrid.appendChild(dishItem);
            });
        }

        /**
         * åˆ é™¤èœå“ (ä» Dish Class åˆ é™¤)
         */
        async function deleteDish(dishObjectId) {
            if (currentRole !== 'parent') return;

            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™é“èœå“å—ï¼Ÿ')) return;

            const dishToDelete = AV.Object.createWithoutData('Dish', dishObjectId);
            try {
                await dishToDelete.destroy();
                showNotification('èœå“åˆ é™¤æˆåŠŸï¼', 'success');
                filterManageDishes(); // åˆ·æ–°ç®¡ç†åˆ—è¡¨
            } catch (error) {
                console.error("åˆ é™¤èœå“å¤±è´¥:", error);
                showNotification('åˆ é™¤å¤±è´¥ï¼', 'error');
            }
        }

        // =======================================================
        // ========== å¿ƒæ„¿å• (Wishlist Class) ==========
        // =======================================================

        /**
         * æ·»åŠ å¿ƒæ„¿å• (ä¿å­˜åˆ° Wishlist Class)
         */
        async function addToWishlist() {
            const text = document.getElementById('wishlistText').value.trim();
            
            if (!text && !currentWishlistImage) {
                showNotification('è¯·è¾“å…¥æ–‡å­—æˆ–ä¸Šä¼ å›¾ç‰‡ï¼', 'error');
                return;
            }

            const wish = new Wishlist();
            wish.set('text', text);
            wish.set('image', currentWishlistImage); // å­˜å‚¨å›¾ç‰‡ URL
            wish.set('role', currentRole); // è®°å½•æ˜¯å“ªä¸ªè§’è‰²æçš„å¿ƒæ„¿å•

            try {
                await wish.save();
                showNotification('å¿ƒæ„¿å•å·²æˆåŠŸå‘é€ç»™çˆ¸çˆ¸å¦ˆå¦ˆï¼', 'success');

                // æ¸…ç©ºè¡¨å•
                document.getElementById('wishlistText').value = '';
                document.getElementById('wishlistImagePreview').innerHTML = '';
                currentWishlistImage = null;
                
                renderWishlist(); // åˆ·æ–°å¿ƒæ„¿å•åˆ—è¡¨
            } catch (error) {
                 console.error("æ·»åŠ å¿ƒæ„¿å•å¤±è´¥:", error);
                 showNotification('å‘é€å¿ƒæ„¿å•å¤±è´¥ï¼', 'error');
            }
        }

        /**
         * æ¸²æŸ“å¿ƒæ„¿å•åˆ—è¡¨ (ä» LeanCloud è·å– Wishlist Class)
         */
        async function renderWishlist() {
            const wishlistList = document.getElementById('wishlistList');
            wishlistList.innerHTML = 'æ­£åœ¨åŠ è½½å¿ƒæ„¿å•...';
            
            const allWishes = await fetchWishlist(); // ä» LeanCloud è·å–
            wishlistList.innerHTML = '';

            if (allWishes.length === 0) {
                 wishlistList.innerHTML = '<p style="text-align: center;">æš‚æ— å¿ƒæ„¿å•è®°å½•ã€‚</p>';
                 return;
            }

            allWishes.forEach(wish => {
                const item = document.createElement('div');
                item.className = 'wishlist-item';
                item.innerHTML = `
                    <div class="wishlist-text">
                        ${wish.text ? `<strong>æ–‡å­—:</strong> ${wish.text}<br>` : ''}
                        <small>æ¥è‡ª: ${wish.role === 'child' ? 'å­©å­' : wish.role}</small>
                    </div>
                    ${wish.image ? `<img src="${wish.image}" class="wishlist-image" alt="å¿ƒæ„¿å›¾ç‰‡">` : ''}
                    ${currentRole === 'parent' ? `<button class="btn btn-danger btn-sm" onclick="deleteWishlistItem('${wish.objectId}')">Ã— åˆ é™¤</button>` : ''}
                `;
                wishlistList.appendChild(item);
            });
        }

        /**
         * åˆ é™¤å¿ƒæ„¿å• (ä»…çˆ¶æ¯è§’è‰²)
         */
        async function deleteWishlistItem(wishObjectId) {
            if (currentRole !== 'parent') return;

            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å¿ƒæ„¿å•è®°å½•å—ï¼Ÿ')) return;

            const wishToDelete = AV.Object.createWithoutData('Wishlist', wishObjectId);
            try {
                await wishToDelete.destroy();
                showNotification('å¿ƒæ„¿å•åˆ é™¤æˆåŠŸï¼', 'success');
                renderWishlist(); // åˆ·æ–°å¿ƒæ„¿å•åˆ—è¡¨
            } catch (error) {
                console.error("åˆ é™¤å¿ƒæ„¿å•å¤±è´¥:", error);
                showNotification('åˆ é™¤å¤±è´¥ï¼', 'error');
            }
        }


        // =======================================================
        // ========== å†å²è®°å½• (History Class) ==========
        // =======================================================

        /**
         * æ¸²æŸ“ç‚¹é¤å†å²è®°å½• (ä» LeanCloud è·å– Order Class)
         */
        async function renderHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = 'æ­£åœ¨åŠ è½½å†å²è®°å½•...';

            const allHistory = await fetchOrderHistory(); // ä» LeanCloud è·å–
            historyList.innerHTML = '';

            if (allHistory.length === 0) {
                 historyList.innerHTML = '<p style="text-align: center;">æš‚æ— ç‚¹é¤å†å²è®°å½•ã€‚</p>';
                 return;
            }

            allHistory.forEach(record => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                // æ¸²æŸ“ç‚¹é¤èœå“åˆ—è¡¨ï¼ŒåŒ…å«å›¾ç‰‡å’Œåç§°
                let dishesHtml = record.dishes.map(dish => `
                    <div class="history-dish-item">
                        <img src="${dish.image}" alt="${dish.name}" class="history-dish-image">
                        <div class="history-dish-name">${dish.name}</div>
                    </div>
                `).join('');

                // æ¸²æŸ“è¯„ä»·æ˜Ÿçº§
                let ratingStars = '';
                for (let i = 1; i <= 5; i++) {
                    ratingStars += `<span class="star ${i <= record.rating ? 'active' : ''}">â˜…</span>`;
                }

                item.innerHTML = `
                    <div class="history-date">${record.date} - ${getMealTypeName(record.mealType)} (æ“ä½œäºº: ${record.role})</div>
                    <div class="history-dishes">
                        <strong>ç‚¹é€‰èœå“:</strong>
                        <div class="history-dishes-list">${dishesHtml}</div>
                    </div>
                    
                    <div class="rating-area" data-id="${record.objectId}">
                        <strong>å¤–å©†æ‰‹è‰ºè¯„ä»·:</strong>
                        <div class="rating" id="rating-${record.objectId}">${ratingStars}</div>
                        ${record.comment ? `<p style="margin-top: 5px;"><strong>ç•™è¨€:</strong> ${record.comment}</p>` : ''}
                    </div>

                    ${currentRole === 'child' && record.rating === 0 ? `
                        <div class="rating-comment">
                            <textarea id="comment-${record.objectId}" placeholder="ç•™ä¸‹ä½ çš„è¯„ä»·ç•™è¨€..." style="margin-bottom: 5px;"></textarea>
                            <button class="btn btn-success" onclick="submitRating('${record.objectId}')">æäº¤è¯„ä»·</button>
                        </div>
                    ` : ''}

                    ${currentRole === 'child' ? `<button class="btn btn-danger" style="margin-top: 10px;" onclick="deleteHistoryItem('${record.objectId}')">åˆ é™¤è®°å½•</button>` : ''}
                `;
                historyList.appendChild(item);
            });
            
            // ç»‘å®šæ˜Ÿçº§ç‚¹å‡»äº‹ä»¶ï¼ˆä»…å­©å­è§’è‰²å¯ä»¥è¯„ä»·ï¼‰
            if (currentRole === 'child') {
                 document.querySelectorAll('.rating-area').forEach(area => {
                    const objectId = area.dataset.id;
                    area.querySelectorAll('.star').forEach((star, index) => {
                        star.onclick = () => {
                            // å®æ—¶é¢„è§ˆæ˜Ÿçº§ï¼Œä½†å°šæœªæäº¤
                            area.querySelectorAll('.star').forEach((s, i) => {
                                s.classList.toggle('active', i <= index);
                            });
                            // å­˜å‚¨å½“å‰é€‰æ‹©çš„æ˜Ÿçº§åˆ° DOM å±æ€§ï¼Œæ–¹ä¾¿æäº¤æ—¶è·å–
                            document.getElementById(`rating-${objectId}`).dataset.tempRating = index + 1;
                        };
                    });
                 });
            }
        }


        /**
         * åˆ é™¤ç‚¹é¤å†å²è®°å½• (ä»…å­©å­è§’è‰²)
         */
        async function deleteHistoryItem(orderObjectId) {
            if (currentRole !== 'child') return;

            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ç‚¹é¤è®°å½•å—ï¼Ÿ')) return;

            const orderToDelete = AV.Object.createWithoutData('Order', orderObjectId);
            try {
                await orderToDelete.destroy();
                showNotification('ç‚¹é¤è®°å½•åˆ é™¤æˆåŠŸï¼', 'success');
                renderHistory(); // åˆ·æ–°å†å²è®°å½•åˆ—è¡¨
            } catch (error) {
                console.error("åˆ é™¤è®¢å•å¤±è´¥:", error);
                showNotification('åˆ é™¤å¤±è´¥ï¼', 'error');
            }
        }

        /**
         * æäº¤è¯„ä»· (æ›´æ–° Order Class)
         */
        async function submitRating(orderObjectId) {
            if (currentRole !== 'child') return;

            const ratingElement = document.getElementById(`rating-${orderObjectId}`);
            const comment = document.getElementById(`comment-${orderObjectId}`).value.trim();
            const rating = parseInt(ratingElement.dataset.tempRating) || 0;

            if (rating === 0) {
                showNotification('è¯·è‡³å°‘é€‰æ‹©ä¸€é¢—æ˜Ÿè¿›è¡Œè¯„ä»·ï¼', 'error');
                return;
            }

            const orderToUpdate = AV.Object.createWithoutData('Order', orderObjectId);
            orderToUpdate.set('rating', rating);
            orderToUpdate.set('comment', comment);

            try {
                await orderToUpdate.save(); // è·¨ç«¯åŒæ­¥æ›´æ–°
                showNotification('è¯„ä»·æäº¤æˆåŠŸï¼', 'success');
                renderHistory(); // åˆ·æ–°å†å²è®°å½•ä»¥æ˜¾ç¤ºæœ€æ–°è¯„ä»·
            } catch (error) {
                console.error("æäº¤è¯„ä»·å¤±è´¥:", error);
                showNotification('æäº¤è¯„ä»·å¤±è´¥ï¼', 'error');
            }
        }


        // =======================================================
        // ========== äº‹ä»¶ç›‘å¬ (å›¾ç‰‡ä¸Šä¼ ) ==========
        // =======================================================

        // çˆ¶æ¯ - æ·»åŠ èœå“å›¾ç‰‡ä¸Šä¼ 
        document.getElementById('imageUpload').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (file) {
                const imageUrl = await uploadImageToLeanCloud(file);
                if (imageUrl) {
                    currentImage = imageUrl;
                    document.getElementById('imagePreview').innerHTML = `<img src="${imageUrl}" style="max-width: 100%; max-height: 150px; border-radius: 8px;">`;
                }
            }
        });

        // å­©å­/çˆ¶æ¯ - å¿ƒæ„¿å•å›¾ç‰‡ä¸Šä¼ 
        document.getElementById('wishlistImageUpload').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (file) {
                const imageUrl = await uploadImageToLeanCloud(file);
                if (imageUrl) {
                    currentWishlistImage = imageUrl;
                    document.getElementById('wishlistImagePreview').innerHTML = `<img src="${imageUrl}" style="max-width: 100%; max-height: 150px; border-radius: 8px;">`;
                }
            }
        });
    </script>
</body>
</html>

